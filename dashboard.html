<!DOCTYPE html> 
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - CorrectMe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .flashcard-container { perspective: 1000px; }
        .flashcard { position: relative; transform-style: preserve-3d; transition: transform 0.6s; }
        .flashcard.is-flipped { transform: rotateY(180deg); }
        .flashcard-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        .flashcard-back { transform: rotateY(180deg); }
        .shake { animation: shake 0.5s; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
        .nav-button.active svg, .nav-button.active span { color: #A78BFA; }
        
        /* ANIMA√á√ÉO DO ROBOZINHO A DAN√áAR */
        .robot-dance {
            display: inline-block;
            font-size: 2.5rem;
            animation: dance 1.s infinite ease-in-out;
        }
        @keyframes dance {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-15deg); }
            75% { transform: rotate(15deg); }
        }
    </style>
</head>
<body class="bg-slate-900 text-white">

    <!-- Header Fixo para Mobile -->
    <header class="lg:hidden sticky top-0 bg-slate-800/80 backdrop-blur-sm z-20 p-4 flex justify-between items-center border-b border-slate-700">
        <a href="index.html"><img src="https://neureka-ai.com/wp-content/uploads/2025/08/LogobrancofundoTransparentev1.png" alt="Logo CorrectMe" class="h-24" onerror="this.onerror=null;this.src='https://placehold.co/120x32/1e293b/ffffff?text=CorrectMe';"></a>
        <button id="logout-button-mobile" class="bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded-lg text-sm">Sair</button>
    </header>

    <!-- Layout principal -->
    <div class="lg:grid lg:grid-cols-3 lg:gap-8">

        <!-- Coluna 1: Perfil (Conte√∫do ser√° injetado) -->
        <aside id="perfil-section" class="mobile-section lg:col-span-1 lg:bg-slate-800 lg:p-8 p-6 flex flex-col pb-24 lg:pb-6">
            <!-- O template do perfil ser√° injetado aqui -->
        </aside>

        <!-- Coluna 2: Reda√ß√£o -->
        <main id="redacao-section" class="mobile-section hidden lg:block lg:col-span-1 p-6 md:p-8">
            <h1 class="text-3xl md:text-4xl font-extrabold mb-2 bg-gradient-to-r from-purple-400 to-blue-500 text-transparent bg-clip-text">Corrija sua Reda√ß√£o</h1>
            <p class="text-slate-400 mb-10">Envie seu texto e receba uma an√°lise detalhada.</p>
            <form id="correction-form" class="space-y-6 pb-24 lg:pb-0">
                <div>
                    <label for="user-name" class="block text-sm font-medium text-slate-300">Nome</label>
                    <input type="text" id="user-name" name="nome" class="mt-1 block w-full bg-slate-800 border border-slate-700 rounded-md py-3 px-4 text-white focus:outline-none focus:ring-purple-500" placeholder="Seu nome" required>
                </div>
                <div>
                    <label for="redacao" class="block text-sm font-medium text-slate-300">Sua reda√ß√£o</label>
                    <textarea id="redacao" name="redacao" rows="8" class="mt-1 block w-full bg-slate-800 border border-slate-700 rounded-md py-3 px-4 text-white focus:outline-none focus:ring-purple-500" placeholder="Escreva seu texto aqui..." required spellcheck="false"></textarea>
                    <div id="word-counter" class="text-right text-xs text-slate-400 mt-1"></div>
                </div>
                <fieldset>
                    <legend class="text-base font-medium text-slate-300">N√≠vel de alem√£o</legend>
                    <div class="mt-4 space-y-4">
                        <div class="flex items-center"><input id="nivel-a" name="nivel" type="radio" value="A1/A2" class="h-4 w-4 text-purple-600 border-slate-700" checked><label for="nivel-a" class="ml-3 block text-sm">A1 / A2 (B√°sico)</label></div>
                        <div class="flex items-center"><input id="nivel-b" name="nivel" type="radio" value="B1/B2" class="h-4 w-4 text-purple-600 border-slate-700"><label for="nivel-b" class="ml-3 block text-sm">B1 / B2 (Intermedi√°rio)</label></div>
                        <div class="flex items-center"><input id="nivel-c" name="nivel" type="radio" value="C1/C2" class="h-4 w-4 text-purple-600 border-slate-700"><label for="nivel-c" class="ml-3 block text-sm">C1 / C2 (Avan√ßado)</label></div>
                    </div>
                </fieldset>
                <button type="submit" class="w-full flex justify-center py-3 px-4 rounded-md font-medium text-white bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700">Corrigir agora!</button>
                
                <!-- ALTERA√á√ÉO: Rob√¥ e mensagem movidos para aqui -->
                <div class="mt-6 text-center">
                    <div class="robot-dance">ü§ñ</div>
                    <p class="text-yellow-400 text-sm mt-2">Que tal conversar com nosso chatbot em alem√£o?</p>
                </div>

            </form>
            <div id="form-message" class="mt-4 text-center"></div>
        </main>

        <!-- Coluna 3: Estat√≠sticas -->
        <aside id="estatistica-section" class="mobile-section hidden lg:block lg:col-span-1 p-6 md:p-8">
            <div class="bg-slate-800 p-6 md:p-8 rounded-lg h-full">
                <h2 class="text-2xl md:text-3xl font-bold mb-6">Seu Progresso</h2>
                <div class="space-y-4 text-base md:text-lg mb-8">
                    <div class="flex justify-between"><span class="text-slate-400">Data de In√≠cio:</span><span id="start-date" class="font-bold">--/--/----</span></div>
                    <div class="flex justify-between"><span class="text-slate-400">Reda√ß√µes Enviadas:</span><span id="total-essays" class="font-bold">0</span></div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-1 xl:grid-cols-2 gap-8 items-center">
                    <div class="flex flex-col items-center">
                        <h3 class="text-lg md:text-xl font-bold mb-4 text-center">Distribui√ß√£o de Erros</h3>
                        <div class="relative w-full max-w-xs h-64 sm:h-auto"><canvas id="error-chart"></canvas></div>
                    </div>
                    <div class="space-y-3 text-sm md:text-base bg-slate-900 p-4 rounded-md">
                        <div class="flex justify-between"><span class="text-slate-400">Declina√ß√£o:</span><span id="error-declinacao" class="font-semibold text-purple-400">0 erros</span></div>
                        <div class="flex justify-between"><span class="text-slate-400">Conjuga√ß√£o:</span><span id="error-conjugacao" class="font-semibold text-blue-400">0 erros</span></div>
                        <div class="flex justify-between"><span class="text-slate-400">Sintaxe:</span><span id="error-sintaxe" class="font-semibold text-green-400">0 erros</span></div>
                        <div class="flex justify-between"><span class="text-slate-400">Preposi√ß√£o:</span><span id="error-preposicao" class="font-semibold text-orange-400">0 erros</span></div>
                        <div class="flex justify-between"><span class="text-slate-400">Vocabul√°rio:</span><span id="error-vocabulario" class="font-semibold text-red-400">0 erros</span></div>
                    </div>
                </div>
                <div class="mt-12 pb-24 lg:pb-0">
                    <h3 class="text-lg md:text-xl font-bold mb-4 text-center">Hist√≥rico de Erros</h3>
                    <div id="history-chart-container" class="relative" style="min-height: 300px;"><canvas id="history-chart"></canvas></div>
                </div>
            </div>
        </aside>

        <!-- Se√ß√£o de Flashcards (Apenas para Mobile) -->
        <section id="flashcards-section" class="mobile-section hidden p-6 md:p-8">
             <!-- O template dos flashcards ser√° injetado aqui para o mobile -->
        </section>
    </div>

    <!-- Barra de Navega√ß√£o para Mobile -->
    <footer class="lg:hidden fixed bottom-0 left-0 right-0 bg-slate-800 border-t border-slate-700 flex justify-around p-2 z-20">
        <button class="nav-button flex flex-col items-center text-slate-400 p-2 active" data-target="perfil-section">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>
            <span class="text-xs mt-1">Perfil</span>
        </button>
        <button class="nav-button flex flex-col items-center text-slate-400 p-2" data-target="redacao-section">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
            <span class="text-xs mt-1">Reda√ß√£o</span>
        </button>
        <button class="nav-button flex flex-col items-center text-slate-400 p-2" data-target="estatistica-section">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>
            <span class="text-xs mt-1">Estat√≠sticas</span>
        </button>
        <button class="nav-button flex flex-col items-center text-slate-400 p-2" data-target="flashcards-section"> 
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" /></svg>
            <span class="text-xs mt-1">Flashcards</span>
        </button>
    </footer>

    <!-- Template do Perfil (injeta o container dos flashcards para desktop) -->
    <template id="profile-template">
        <div class="flex justify-between items-center mb-8">
            <h2 class="text-2xl font-bold">Meu Perfil</h2>
            <button id="logout-button-desktop" class="hidden lg:block bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg text-sm">Sair</button>
        </div>
        <div class="flex flex-col items-center text-center">
            <img id="profile-pic" src="https://placehold.co/150x150/172a45/ccd6f6?text=Foto" alt="Foto do Perfil" class="w-32 h-32 rounded-full object-cover border-4 border-slate-700">
            <div class="mt-4">
                <label for="avatar-input-dashboard" class="cursor-pointer bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 px-4 rounded-lg text-sm">Inserir foto</label>
                <input type="file" id="avatar-input-dashboard" accept="image/*" class="hidden">
            </div>
            <p id="user-email" class="text-slate-300 w-full truncate mt-4">Carregando...</p>
            <div class="mt-6 bg-slate-700 p-4 rounded-lg w-full">
                <p class="text-lg text-slate-400">Cr√©ditos Restantes</p>
                <p id="user-credits" class="text-4xl font-bold text-purple-400">...</p>
            </div>
        </div>
        <div class="mt-8">
            <h3 class="text-xl font-bold mb-4 text-center">Comprar Cr√©ditos</h3>
            <div class="space-y-2">
                <button data-price-id="price_1RusAKCYJo68kcPWjlHcTBSC" class="buy-credits-btn w-full bg-gradient-to-r from-blue-800 to-blue-900 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-2 px-4 rounded-lg">Comprar 500 Cr√©ditos</button>
                <button data-price-id="price_1RusCBCYJo68kcPWGnvYB6f8" class="buy-credits-btn w-full bg-gradient-to-r from-blue-800 to-blue-900 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-2 px-4 rounded-lg">Comprar 1000 Cr√©ditos</button>
                <button data-price-id="price_1RusDPCYJo68kcPWTlp9t9hz" class="buy-credits-btn w-full bg-gradient-to-r from-blue-800 to-blue-900 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-2 px-4 rounded-lg">Comprar 1500 Cr√©ditos</button>
            </div>
        </div>

        <!-- NOVO BOT√ÉO PARA LISTA DE PALAVRAS -->
        <div class="mt-8">
             <h3 class="text-xl font-bold mb-4 text-center">Listas de Vocabul√°rio</h3>
             <a href="wordlist.html" class="block">
                 <button class="w-full bg-yellow-500 hover:bg-yellow-600 text-slate-900 font-bold py-3 px-4 rounded-lg transition-colors flex items-center justify-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path></svg>
                    <span>Gerenciar Minhas Listas</span>
                 </button>
             </a>
         </div>

        <!-- Container para injetar os flashcards na vista de desktop -->
        <div id="flashcard-desktop-container">
            <!-- O JS vai injetar o template de flashcards aqui -->
        </div>
    </template>

    <!-- Template dos Flashcards -->
    <template id="flashcards-template">
        <div class="mt-8 flex-grow flex flex-col">
            <h2 class="text-2xl font-bold mb-8 text-center">Meus Flashcards</h2>
            <div class="flashcard-start-container text-center bg-slate-700 p-4 rounded-lg max-w-md mx-auto">
                <p class="flashcard-message text-slate-300 mb-4 text-sm"></p>
                <button class="start-flashcard-btn bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-lg hidden">Praticar</button>
            </div>
            <div class="flashcard-game-container hidden max-w-md mx-auto">
                <div class="flashcard-container h-32">
                    <div class="flashcard w-full h-full">
                        <div class="flashcard-face bg-slate-700 rounded-lg"><p class="flashcard-word text-3xl font-bold"></p></div>
                        <div class="flashcard-back flashcard-face flashcard-back rounded-lg"><p class="flashcard-feedback-text text-xl font-bold text-center px-2"></p></div>
                    </div>
                </div>
                <div class="article-buttons flex justify-around mt-4">
                    <button class="article-btn text-xl font-bold bg-slate-700 hover:bg-slate-600 rounded-lg py-2 px-6" data-article="der">der</button>
                    <button class="article-btn text-xl font-bold bg-slate-700 hover:bg-slate-600 rounded-lg py-2 px-6" data-article="die">die</button>
                    <button class="article-btn text-xl font-bold bg-slate-700 hover:bg-slate-600 rounded-lg py-2 px-6" data-article="das">das</button>
                </div>
            </div>
        </div>
    </template>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- =================================================================== -->
    <!-- IN√çCIO DO C√ìDIGO DE INTEGRA√á√ÉO DO CHATBOT CORRECTME                 -->
    <!-- =================================================================== -->

    <!-- Scripts para renderiza√ß√£o segura de Markdown (necess√°rio para o chatbot) -->
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.5/dist/purify.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <script>
        // Configura a biblioteca 'marked' para interpretar quebras de linha
        marked.setOptions({ breaks: true });
        
        // Fun√ß√£o global para renderizar Markdown de forma segura, usada pelo script do chatbot
        function renderMarkdown(input) {
            const dirtyHTML = marked.parse(input);
            const cleanHTML = DOMPurify.sanitize(dirtyHTML);
            return cleanHTML;
        }
        
        // Configura√ß√£o espec√≠fica para o seu site
        window.ChatWidgetConfig = {
            webhook: {
                url: '/.netlify/functions/chatbot',
            }
        };
    </script>

    <!-- Script principal do Chatbot CorrectMe -->
    <script src="bot_051.js" defer></script>
    
    <!-- =================================================================== -->
    <!-- FIM DO C√ìDIGO DE INTEGRA√á√ÉO DO CHATBOT                              -->
    <!-- =================================================================== -->

    <script src="dashboard.js"></script>

</body>
</html>

